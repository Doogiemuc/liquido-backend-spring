# Spring Backend for my Liquido WebApp

This is a more technical guide for developers

## Process Model from an idea to a Law

 - At first there is an short rough idea. (NEW_IDEA)
 - When an idea reaches its quorum, then it becomes a proposal. (NEW_PROPOSAL)
 - Alternative proposals can be added to that initial proposal. (NEW_PROPOSAL) 
   But they first need to reach a certain quorum too, before they can be voted upon.
 - Each proposal can be discussed. Comments can be voted up and down. (ELABORATION)
 - n days after the initial proposal reached its quorum, then the voting phase starts. 
   All competing proposals can be voted upon. (VOTING_PHASE)
 - The winning proposal becomes a law (LAW) and all other proposals are (DECLINED)

## Wording

"idea"          := rough and short
"proposal"      := reached its quorum
"law"           := won a vote


## Backlog / User Stories

## Global configuration / settings

   - number of likes that are necessary to move an idea onto the table
   - number of supporters that are necessary for a proposal to reach its quorum

## "Profile" default values for new polls

  - when does a voting phase / poll start
    a) n days after the initial proposal reached its quorum
    b) when there are at least n alternative proposals (with quorum each)
    c) manually started by the admin
  - duration of elaboration phase
  - duration of voting phase

### Ideas

 - I "Like to discuss" an idea
 - Move an idea onto the table when the necessary quorum is reached.

### Laws

 - Edit the description of a law proposal
 - Add a suggestion to a law
 - Up/Down-vote a suggestion.
 - Sort competing proposals into vote order (XXL)


# Build pipeline

# Compile and build

 * Rename `src/main/resources/application.properties.example` to `application.properties` and fill in all necessary passwords.
 * Build `mvn package`
 * Run: `mvn install && mvn run:jetty`

### Docker build

 * If you are on Windows: Start "Docker for Windows" `mvn dockerfile:build`
 * Run `docker run org.doogie/liquido-backend-spring`

## Test

Run the test cases under `srs/test/java` with `mvn test`.
Spring Boot will automatically start the test server for you.
Test data is automatically created by the `TestDataCreator.java`.

# Dev Links

 * There is an Swagger API documentation (autogenerated with Springfox) at  http://localhost:8080/swagger-ui.html
 * [H2 DB Web Console](http://localhost:8080/h2-console)   JDBC URL: `jdbc:h2:mem:testdb`   Username: `sa` - no pwd, Driver Class: `org.h2.Driver`    * https://springframework.guru/using-the-h2-database-console-in-spring-boot-with-spring-security/


# Software Architecture

https://www.draw.io/#LLiquido%20Architecture


## Spring Security

 - [Spring Security Reference](http://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#test-method-withuserdetails)
 - [Tutorial Spring Security with Angular JS](https://spring.io/guides/tutorials/spring-security-and-angular-js/#_the_login_page_angular_js_and_spring_security_part_ii)
 - [Hello Spring Security with Boot](http://docs.spring.io/spring-security/site/docs/current/guides/html5//helloworld-boot.html#updating-your-dependencies)
 - [Spring Data JPA Auditing](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing)
 - [Spring Data Rest - Security](http://docs.spring.io/spring-data/rest/docs/current/reference/html/#security)

## Good Spring Boot Resources
 
 - https://github.com/spring-projects/spring-data-examples
 - Book+++: High Performance Java Persistence: https://leanpub.com/high-performance-java-persistence?utm_source=blog&utm_medium=banner&utm_campaign=banner
 - [Great Hibernate Tutorials](https://vladmihalcea.com/tutorials/hibernate/)  about mappings and sequences

## One Time Token
 - [Custom token based authentication of REST services](https://www.future-processing.pl/blog/exploring-spring-boot-and-spring-security-custom-token-based-authentication-of-rest-services-with-spring-security-and-pinch-of-spring-java-configuration-and-spring-integration-testing/)
 - [Github: Passwordless Auth](https://github.com/creactiviti/spring-security-passwordless)


## Two factor authentication

 - [Two Factor Auth with Spring Security (by Baeldung](https://www.baeldung.com/spring-security-two-factor-authentication-with-soft-token)
 - Google Authenticator
 - QRCode generator https://github.com/kenglxn/QRGen  (built upon ZXING)

## Oauth 2.0

 - [Baelddung Oauth Tutorials Overview](https://www.baeldung.com/spring-security-oauth)
 - [Baeldung Tutorial Oauth with JWT](https://www.baeldung.com/spring-security-oauth-jwt)
 - [Very nice Sprint Boot example app for JWT](https://github.com/nydiarra/springboot-jwt)
 
 ### OLD: conneetion to MongoDB
 
    # MongoDB via spring-data-mongo
    spring.data.mongodb.uri=mongodb://testuser:PASSWORD@ds019664.mlab.com:19664/liquido-test
    spring.data.mongodb.uri=mongodb://localhost:27017/liquido-test
    
