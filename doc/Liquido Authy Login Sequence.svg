<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1906px" preserveAspectRatio="none" style="width:964px;height:1906px;" version="1.1" viewBox="0 0 964 1906" width="964px" zoomAndPan="magnify"><defs><filter height="300%" id="fvk4z5taths1d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="193.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="201.6953"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="91.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="467.8906"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="275.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="727.0859"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="135.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1099.5469"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="329.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1474.0078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="24" x2="24" y1="88.2969" y2="1821.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="215" x2="215" y1="88.2969" y2="1821.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="540" x2="540" y1="88.2969" y2="1821.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="796" x2="796" y1="88.2969" y2="1821.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="5" y="84.9951">User</text><ellipse cx="24" cy="15" fill="#FEFECE" filter="url(#fvk4z5taths1d)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M24,23 L24,50 M11,31 L37,31 M24,50 L11,65 M24,50 L37,65 " fill="none" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="5" y="1833.8623">User</text><ellipse cx="24" cy="1847.1641" fill="#FEFECE" filter="url(#fvk4z5taths1d)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M24,1855.1641 L24,1882.1641 M11,1863.1641 L37,1863.1641 M24,1882.1641 L11,1897.1641 M24,1882.1641 L37,1897.1641 " fill="none" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="168" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="175" y="72.9951">LiquidoApp</text><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="168" y="1820.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="175" y="1840.8623">LiquidoApp</text><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="128" x="474" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="481" y="72.9951">Liquido Backend</text><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="128" x="474" y="1820.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="481" y="1840.8623">Liquido Backend</text><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="757" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="764" y="72.9951">AuthyAPI</text><rect fill="#FEFECE" filter="url(#fvk4z5taths1d)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="757" y="1820.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="764" y="1840.8623">AuthyAPI</text><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="193.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="201.6953"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="91.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="467.8906"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="275.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="727.0859"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="135.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1099.5469"/><rect fill="#FFFFFF" filter="url(#fvk4z5taths1d)" height="329.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1474.0078"/><path d="M639,103.2969 L639,128.2969 L948,128.2969 L948,113.2969 L938,103.2969 L639,103.2969 " fill="#FBFB77" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M938,103.2969 L938,113.2969 L948,113.2969 L938,103.2969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="645" y="120.3638">https://api.authy.com/protected/json</text><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="957" x="0" y="157.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="157.9961" y2="157.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="160.9961" y2="160.9961"/><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="81" x="438" y="147.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="444" y="163.4966">Register</text><polygon fill="#A80036" points="198,197.6953,208,201.6953,198,205.6953,202,201.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="201.6953" y2="201.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="31" y="196.6294">"/welcome"</text><polygon fill="#A80036" points="528,241.9609,538,245.9609,528,249.9609,532,245.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="245.9609" y2="245.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="227" y="225.7622">POST /auth/register</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="227" y="240.895">{email, profile.mobilephone}</text><rect fill="#ADD8E6" filter="url(#fvk4z5taths1d)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="216" x="432" y="258.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="436" y="275.0278">UserService.registerUser()</text><polygon fill="#A80036" points="784,304.2266,794,308.2266,784,312.2266,788,308.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="790" y1="308.2266" y2="308.2266"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="547" y="303.1606">POST /users/new</text><polygon fill="#A80036" points="551,333.3594,541,337.3594,551,341.3594,547,337.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="545" x2="795" y1="337.3594" y2="337.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="557" y="332.2935">HTTP 200 OK</text><polygon fill="#A80036" points="231,362.4922,221,366.4922,231,370.4922,227,366.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="539" y1="366.4922" y2="366.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="237" y="361.4263">HTTP 200 OK</text><polygon fill="#A80036" points="35,391.625,25,395.625,35,399.625,31,395.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="214" y1="395.625" y2="395.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="41" y="390.5591">registered successfully</text><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="957" x="0" y="424.1914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="424.1914" y2="424.1914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="427.1914" y2="427.1914"/><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="59" x="449" y="413.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="455" y="429.6919">Login</text><polygon fill="#A80036" points="198,463.8906,208,467.8906,198,471.8906,202,467.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="467.8906" y2="467.8906"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="31" y="462.8247">/login</text><polygon fill="#A80036" points="528,493.0234,538,497.0234,528,501.0234,532,497.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="497.0234" y2="497.0234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="227" y="491.9575">/auth/requestToken</text><rect fill="#ADD8E6" filter="url(#fvk4z5taths1d)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="320" x="380" y="510.0234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="384" y="526.0903">UserService.sendSmsOrPushNotification()</text><polygon fill="#A80036" points="784,555.2891,794,559.2891,784,563.2891,788,559.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="790" y1="559.2891" y2="559.2891"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="547" y="554.2231">GET /sms/{AUTHY_ID}</text><path d="M653,572.2891 L653,627.2891 L935,627.2891 L935,582.2891 L925,572.2891 L653,572.2891 " fill="#FBFB77" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M925,572.2891 L925,582.2891 L935,582.2891 L925,572.2891 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="659" y="589.356">SMS is sent or AuthyApp pops up</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="659" y="604.4888">and shows One Time Token (OTT) to user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="659" y="619.6216">2FA: User switches back to LiquidoApp</text><ellipse cx="23.5" cy="657.0703" fill="none" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;"/><polygon fill="#0000FF" points="40.5,653.8203,30.5,657.8203,40.5,661.8203,36.5,657.8203" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="38.5" x2="795" y1="657.8203" y2="657.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="649" x="41" y="652.7544">User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.</text><polygon fill="#A80036" points="198,723.0859,208,727.0859,198,731.0859,202,727.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="727.0859" y2="727.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="31" y="706.8872">user manually enters OTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="31" y="722.02">in LiquidoApp</text><polygon fill="#A80036" points="528,752.2188,538,756.2188,528,760.2188,532,756.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="756.2188" y2="756.2188"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="227" y="751.1528">/auth/loginWithToken</text><rect fill="#ADD8E6" filter="url(#fvk4z5taths1d)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="288" x="396" y="769.2188"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="400" y="785.2856">UserService.verifyOneTimePassword()</text><polygon fill="#A80036" points="784,814.4844,794,818.4844,784,822.4844,788,818.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="540" x2="790" y1="818.4844" y2="818.4844"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="547" y="813.4185">GET verify/{TOKEN}/{AUTHY_ID}</text><polygon fill="#A80036" points="551,843.6172,541,847.6172,551,851.6172,547,847.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="545" x2="795" y1="847.6172" y2="847.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="557" y="842.5513">HTTP 200 OK</text><path d="M395,860.6172 L395,900.6172 L681,900.6172 L681,870.6172 L671,860.6172 L395,860.6172 " fill="#FBFB77" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M671,860.6172 L671,870.6172 L681,870.6172 L671,860.6172 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="401" y="877.6841">If user is member of more than one team</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="401" y="892.8169">then log him into his last used team.</text><polygon fill="#A80036" points="231,927.0156,221,931.0156,231,935.0156,227,931.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="539" y1="931.0156" y2="931.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="237" y="925.9497">JsonWebToken (JWT)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="262" y1="960.1484" y2="960.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="262" x2="262" y1="960.1484" y2="973.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="221" x2="262" y1="973.1484" y2="973.1484"/><polygon fill="#A80036" points="231,969.1484,221,973.1484,231,977.1484,227,973.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="227" y="955.0825">cache JWT in localStorage</text><polygon fill="#A80036" points="35,998.2813,25,1002.2813,35,1006.2813,31,1002.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="214" y1="1002.2813" y2="1002.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="41" y="997.2153">login successful</text><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="957" x="0" y="1055.8477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1055.8477" y2="1055.8477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1058.8477" y2="1058.8477"/><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="112" x="422.5" y="1045.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="428.5" y="1061.3481">Switch Team</text><polygon fill="#A80036" points="198,1095.5469,208,1099.5469,198,1103.5469,202,1099.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="1099.5469" y2="1099.5469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="31" y="1094.481">/team</text><polygon fill="#A80036" points="528,1139.8125,538,1143.8125,528,1147.8125,532,1143.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="1143.8125" y2="1143.8125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="227" y="1123.6138">/auth/switchTeam</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="227" y="1138.7466">(authenticated call with JWT)</text><rect fill="#ADD8E6" filter="url(#fvk4z5taths1d)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="200" x="440" y="1156.8125"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="444" y="1172.8794">UserService.switchTeam()</text><polygon fill="#A80036" points="231,1202.0781,221,1206.0781,231,1210.0781,227,1206.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="539" y1="1206.0781" y2="1206.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="237" y="1201.0122">new JWT for new team</text><polygon fill="#A80036" points="35,1231.2109,25,1235.2109,35,1239.2109,31,1235.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="29" x2="214" y1="1235.2109" y2="1235.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="41" y="1230.145">Team Home of new team</text><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="957" x="0" y="1288.7773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1288.7773" y2="1288.7773"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1291.7773" y2="1291.7773"/><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="163" x="397" y="1278.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="403" y="1294.2778">Authenticated Calls</text><polygon fill="#A80036" points="528,1343.6094,538,1347.6094,528,1351.6094,532,1347.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="215" x2="534" y1="1347.6094" y2="1347.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="222" y="1327.4106">authenticated requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="222" y="1342.5435">with JWT in header</text><polygon fill="#A80036" points="226,1372.7422,216,1376.7422,226,1380.7422,222,1376.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="539" y1="1376.7422" y2="1376.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="232" y="1371.6763">HTTP 200 OK</text><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="957" x="0" y="1430.3086"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1430.3086" y2="1430.3086"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="957" y1="1433.3086" y2="1433.3086"/><rect fill="#EEEEEE" filter="url(#fvk4z5taths1d)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="169" x="394" y="1419.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="400" y="1435.8091">Login during testing</text><polygon fill="#A80036" points="198,1470.0078,208,1474.0078,198,1478.0078,202,1474.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="1474.0078" y2="1474.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="31" y="1468.9419">test simulates user</text><polygon fill="#A80036" points="528,1514.2734,538,1518.2734,528,1522.2734,532,1518.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="1518.2734" y2="1518.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="227" y="1498.0747">GraphQL: QUERY</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="227" y="1513.2075">authToken(mobilephone, devLoginToken)</text><path d="M419,1531.2734 L419,1601.2734 L657,1601.2734 L657,1541.2734 L647,1531.2734 L419,1531.2734 " fill="#FBFB77" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M647,1531.2734 L647,1541.2734 L657,1541.2734 L647,1531.2734 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="425" y="1548.3403">UserGraphQL.requestAuthToken()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="425" y="1563.4731">check devLoginToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="425" y="1578.606">User must exist.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="425" y="1593.7388">Then AuthyAPI is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="535" y="1593.7388">not</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="563" y="1593.7388">called.</text><polygon fill="#A80036" points="231,1627.9375,221,1631.9375,231,1635.9375,227,1631.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="539" y1="1631.9375" y2="1631.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="237" y="1626.8716">DummySID</text><polygon fill="#A80036" points="528,1687.3359,538,1691.3359,528,1695.3359,532,1691.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="534" y1="1691.3359" y2="1691.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="227" y="1656.0044">REST call:</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="227" y="1671.1372">GET /devLogin</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="235" y="1686.27">email,teamName,token</text><path d="M434,1704.3359 L434,1729.3359 L641,1729.3359 L641,1714.3359 L631,1704.3359 L434,1704.3359 " fill="#FBFB77" filter="url(#fvk4z5taths1d)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M631,1704.3359 L631,1714.3359 L641,1714.3359 L631,1704.3359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="440" y="1721.4028">DevRestController.devLogin()</text><polygon fill="#A80036" points="231,1770.7344,221,1774.7344,231,1778.7344,227,1774.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="539" y1="1774.7344" y2="1774.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="237" y="1754.5356">Login Data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="237" y="1769.6685">(user, team, jwt)</text><polygon fill="#A80036" points="35,1799.8672,25,1803.8672,35,1807.8672,31,1803.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="214" y1="1803.8672" y2="1803.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="41" y="1798.8013">user is logged in</text><!--MD5=[1b4fbc29117a4bb6f5818a3bd2900e0e]
@startuml
actor User
participant LiquidoApp
participant "Liquido Backend" as BE
participant AuthyAPI

note over AuthyAPI: ""https://api.authy.com/protected/json""

== Register ==

User -> LiquidoApp: "/welcome"
activate LiquidoApp
LiquidoApp -> BE: ""POST /auth/register""\n""{email, profile.mobilephone}""
rnote over BE #lightblue: ""UserService.registerUser()""
BE -> AuthyAPI: ""POST /users/new""
AuthyAPI - -> BE: HTTP 200 OK
BE - -> LiquidoApp: HTTP 200 OK
LiquidoApp - -> User: registered successfully
deactivate LiquidoApp

== Login ==

User -> LiquidoApp: ""/login""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/requestToken""
rnote over BE #lightblue: ""UserService.sendSmsOrPushNotification()""
BE -> AuthyAPI: ""GET /sms/{AUTHY_ID}""
deactivate LiquidoApp

note over AuthyAPI: SMS is sent or AuthyApp pops up\nand shows One Time Token (OTT) to user\n2FA: User switches back to LiquidoApp
AuthyAPI -[#blue]->o User: User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.

|||

User -> LiquidoApp: user manually enters OTT\nin LiquidoApp
activate LiquidoApp
LiquidoApp -> BE: ""/auth/loginWithToken""
rnote over BE #lightblue: ""UserService.verifyOneTimePassword()""
BE -> AuthyAPI: ""GET verify/{TOKEN}/{AUTHY_ID}""
AuthyAPI - -> BE: HTTP 200 OK
note over BE: If user is member of more than one team\nthen log him into his last used team.
BE - -> LiquidoApp: JsonWebToken (JWT)
LiquidoApp -> LiquidoApp: cache JWT in localStorage
LiquidoApp - -> User: login successful
deactivate LiquidoApp

|||
== Switch Team ==

User -> LiquidoApp: ""/team""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/switchTeam""\n(authenticated call with JWT)
rnote over BE #lightblue: ""UserService.switchTeam()""
' should I require authentication via authy here again?
BE - -> LiquidoApp: new JWT for new team
LiquidoApp -> User: Team Home of new team
deactivate LiquidoApp

|||
== Authenticated Calls ==

LiquidoApp -> BE: authenticated requests\nwith JWT in header
BE - -> LiquidoApp: HTTP 200 OK

|||
== Login during testing ==

User -> LiquidoApp: test simulates user
activate LiquidoApp
LiquidoApp -> BE: GraphQL: QUERY\n""authToken(mobilephone, devLoginToken)""
note over BE: UserGraphQL.requestAuthToken()\ncheck devLoginToken\nUser must exist.\nThen AuthyAPI is **not** called.
BE - -> LiquidoApp: DummySID

LiquidoApp -> BE: REST call:\n""GET /devLogin""\n"" email,teamName,token""
note over BE: DevRestController.devLogin()
BE - -> LiquidoApp: Login Data\n(user, team, jwt)
LiquidoApp - -> User: user is logged in
deactivate LiquidoApp
@enduml

@startuml
actor User
participant LiquidoApp
participant "Liquido Backend" as BE
participant AuthyAPI

note over AuthyAPI: ""https://api.authy.com/protected/json""

== Register ==

User -> LiquidoApp: "/welcome"
activate LiquidoApp
LiquidoApp -> BE: ""POST /auth/register""\n""{email, profile.mobilephone}""
rnote over BE #lightblue: ""UserService.registerUser()""
BE -> AuthyAPI: ""POST /users/new""
AuthyAPI - -> BE: HTTP 200 OK
BE - -> LiquidoApp: HTTP 200 OK
LiquidoApp - -> User: registered successfully
deactivate LiquidoApp

== Login ==

User -> LiquidoApp: ""/login""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/requestToken""
rnote over BE #lightblue: ""UserService.sendSmsOrPushNotification()""
BE -> AuthyAPI: ""GET /sms/{AUTHY_ID}""
deactivate LiquidoApp

note over AuthyAPI: SMS is sent or AuthyApp pops up\nand shows One Time Token (OTT) to user\n2FA: User switches back to LiquidoApp
AuthyAPI -[#blue]->o User: User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.

|||

User -> LiquidoApp: user manually enters OTT\nin LiquidoApp
activate LiquidoApp
LiquidoApp -> BE: ""/auth/loginWithToken""
rnote over BE #lightblue: ""UserService.verifyOneTimePassword()""
BE -> AuthyAPI: ""GET verify/{TOKEN}/{AUTHY_ID}""
AuthyAPI - -> BE: HTTP 200 OK
note over BE: If user is member of more than one team\nthen log him into his last used team.
BE - -> LiquidoApp: JsonWebToken (JWT)
LiquidoApp -> LiquidoApp: cache JWT in localStorage
LiquidoApp - -> User: login successful
deactivate LiquidoApp

|||
== Switch Team ==

User -> LiquidoApp: ""/team""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/switchTeam""\n(authenticated call with JWT)
rnote over BE #lightblue: ""UserService.switchTeam()""
BE - -> LiquidoApp: new JWT for new team
LiquidoApp -> User: Team Home of new team
deactivate LiquidoApp

|||
== Authenticated Calls ==

LiquidoApp -> BE: authenticated requests\nwith JWT in header
BE - -> LiquidoApp: HTTP 200 OK

|||
== Login during testing ==

User -> LiquidoApp: test simulates user
activate LiquidoApp
LiquidoApp -> BE: GraphQL: QUERY\n""authToken(mobilephone, devLoginToken)""
note over BE: UserGraphQL.requestAuthToken()\ncheck devLoginToken\nUser must exist.\nThen AuthyAPI is **not** called.
BE - -> LiquidoApp: DummySID

LiquidoApp -> BE: REST call:\n""GET /devLogin""\n"" email,teamName,token""
note over BE: DevRestController.devLogin()
BE - -> LiquidoApp: Login Data\n(user, team, jwt)
LiquidoApp - -> User: user is logged in
deactivate LiquidoApp
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>