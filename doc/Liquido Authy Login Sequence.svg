<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1508px" preserveAspectRatio="none" style="width:907px;height:1508px;" version="1.1" viewBox="0 0 907 1508" width="907px" zoomAndPan="magnify"><defs><filter height="300%" id="fsoqwvb6wu5kg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="193.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="201.6953"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="467.8906"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="275.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="756.2188"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="135.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1128.6797"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="98.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="848" y="588.4219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="24" x2="24" y1="88.2969" y2="1423.875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="215" x2="215" y1="88.2969" y2="1423.875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="468" x2="468" y1="88.2969" y2="1423.875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="724" x2="724" y1="88.2969" y2="1423.875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="853" x2="853" y1="88.2969" y2="1423.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="5" y="84.9951">User</text><ellipse cx="24" cy="15" fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M24,23 L24,50 M11,31 L37,31 M24,50 L11,65 M24,50 L37,65 " fill="none" filter="url(#fsoqwvb6wu5kg)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="5" y="1435.8701">User</text><ellipse cx="24" cy="1449.1719" fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M24,1457.1719 L24,1484.1719 M11,1465.1719 L37,1465.1719 M24,1484.1719 L11,1499.1719 M24,1484.1719 L37,1499.1719 " fill="none" filter="url(#fsoqwvb6wu5kg)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="168" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="175" y="72.9951">LiquidoApp</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="168" y="1422.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="175" y="1442.8701">LiquidoApp</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="128" x="402" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="409" y="72.9951">Liquido Backend</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="128" x="402" y="1422.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="409" y="1442.8701">Liquido Backend</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="685" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="692" y="72.9951">AuthyAPI</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="74" x="685" y="1422.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="692" y="1442.8701">AuthyAPI</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="811" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="818" y="72.9951">AuthyApp</text><rect fill="#FEFECE" filter="url(#fsoqwvb6wu5kg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="80" x="811" y="1422.875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="818" y="1442.8701">AuthyApp</text><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="193.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="201.6953"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="120.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="467.8906"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="275.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="756.2188"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="135.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="210" y="1128.6797"/><rect fill="#FFFFFF" filter="url(#fsoqwvb6wu5kg)" height="98.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="848" y="588.4219"/><path d="M567,103.2969 L567,128.2969 L876,128.2969 L876,113.2969 L866,103.2969 L567,103.2969 " fill="#FBFB77" filter="url(#fsoqwvb6wu5kg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M866,103.2969 L866,113.2969 L876,113.2969 L866,103.2969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="573" y="120.3638">https://api.authy.com/protected/json</text><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="900" x="0" y="157.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="157.9961" y2="157.9961"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="160.9961" y2="160.9961"/><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="81" x="409.5" y="147.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="62" x="415.5" y="163.4966">Register</text><polygon fill="#A80036" points="198,197.6953,208,201.6953,198,205.6953,202,201.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="201.6953" y2="201.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="31" y="196.6294">"/welcome"</text><polygon fill="#A80036" points="456,241.9609,466,245.9609,456,249.9609,460,245.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="462" y1="245.9609" y2="245.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="227" y="225.7622">POST /auth/register</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="227" y="240.895">{email, profile.mobilephone}</text><rect fill="#ADD8E6" filter="url(#fsoqwvb6wu5kg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="216" x="360" y="258.9609"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="364" y="275.0278">UserService.registerUser()</text><polygon fill="#A80036" points="712,304.2266,722,308.2266,712,312.2266,716,308.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468" x2="718" y1="308.2266" y2="308.2266"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="475" y="303.1606">POST /users/new</text><polygon fill="#A80036" points="479,333.3594,469,337.3594,479,341.3594,475,337.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="473" x2="723" y1="337.3594" y2="337.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="485" y="332.2935">HTTP 200 OK</text><polygon fill="#A80036" points="231,362.4922,221,366.4922,231,370.4922,227,366.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="467" y1="366.4922" y2="366.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="237" y="361.4263">HTTP 200 OK</text><polygon fill="#A80036" points="35,391.625,25,395.625,35,399.625,31,395.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="214" y1="395.625" y2="395.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="41" y="390.5591">registered successfully</text><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="900" x="0" y="424.1914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="424.1914" y2="424.1914"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="427.1914" y2="427.1914"/><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="59" x="420.5" y="413.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="426.5" y="429.6919">Login</text><polygon fill="#A80036" points="198,463.8906,208,467.8906,198,471.8906,202,467.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="467.8906" y2="467.8906"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="31" y="462.8247">/login</text><polygon fill="#A80036" points="456,493.0234,466,497.0234,456,501.0234,460,497.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="462" y1="497.0234" y2="497.0234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="227" y="491.9575">/auth/requestToken</text><rect fill="#ADD8E6" filter="url(#fsoqwvb6wu5kg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="320" x="308" y="510.0234"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="312" y="526.0903">UserService.sendSmsOrPushNotification()</text><polygon fill="#A80036" points="712,555.2891,722,559.2891,712,563.2891,716,559.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468" x2="718" y1="559.2891" y2="559.2891"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="475" y="554.2231">GET /sms/{AUTHY_ID}</text><polygon fill="#A80036" points="836,584.4219,846,588.4219,836,592.4219,840,588.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="724" x2="842" y1="588.4219" y2="588.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="731" y="583.356">push notification</text><path d="M573,601.4219 L573,656.4219 L839,656.4219 L839,611.4219 L829,601.4219 L573,601.4219 " fill="#FBFB77" filter="url(#fsoqwvb6wu5kg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M829,601.4219 L829,611.4219 L839,611.4219 L829,601.4219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="579" y="618.4888">AuthyApp pops up and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="579" y="633.6216">shows a One Time Token (OTT) to user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="579" y="648.7544">2FA: User switches back to LiquidoApp</text><ellipse cx="23.5" cy="686.2031" fill="none" rx="4" ry="4" style="stroke:#0000FF;stroke-width:1.5;"/><polygon fill="#0000FF" points="40.5,682.9531,30.5,686.9531,40.5,690.9531,36.5,686.9531" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="38.5" x2="852" y1="686.9531" y2="686.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="649" x="41" y="681.8872">User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.</text><polygon fill="#A80036" points="198,752.2188,208,756.2188,198,760.2188,202,756.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="756.2188" y2="756.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="31" y="736.02">user manually enters OTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="31" y="751.1528">in LiquidoApp</text><polygon fill="#A80036" points="456,781.3516,466,785.3516,456,789.3516,460,785.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="462" y1="785.3516" y2="785.3516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="227" y="780.2856">/auth/loginWithToken</text><rect fill="#ADD8E6" filter="url(#fsoqwvb6wu5kg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="288" x="324" y="798.3516"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="328" y="814.4185">UserService.verifyOneTimePassword()</text><polygon fill="#A80036" points="712,843.6172,722,847.6172,712,851.6172,716,847.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468" x2="718" y1="847.6172" y2="847.6172"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="475" y="842.5513">GET verify/{TOKEN}/{AUTHY_ID}</text><polygon fill="#A80036" points="479,872.75,469,876.75,479,880.75,475,876.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="473" x2="723" y1="876.75" y2="876.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="485" y="871.6841">HTTP 200 OK</text><path d="M323,889.75 L323,929.75 L609,929.75 L609,899.75 L599,889.75 L323,889.75 " fill="#FBFB77" filter="url(#fsoqwvb6wu5kg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M599,889.75 L599,899.75 L609,899.75 L599,889.75 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="329" y="906.8169">If user is member of more than one team</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="329" y="921.9497">then log him into his last used team.</text><polygon fill="#A80036" points="231,956.1484,221,960.1484,231,964.1484,227,960.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="467" y1="960.1484" y2="960.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="237" y="955.0825">JsonWebToken (JWT)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="262" y1="989.2813" y2="989.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="262" x2="262" y1="989.2813" y2="1002.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="221" x2="262" y1="1002.2813" y2="1002.2813"/><polygon fill="#A80036" points="231,998.2813,221,1002.2813,231,1006.2813,227,1002.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="227" y="984.2153">cache JWT in localStorage</text><polygon fill="#A80036" points="35,1027.4141,25,1031.4141,35,1035.4141,31,1031.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="29" x2="214" y1="1031.4141" y2="1031.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="41" y="1026.3481">login successful</text><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="900" x="0" y="1084.9805"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="1084.9805" y2="1084.9805"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="1087.9805" y2="1087.9805"/><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="112" x="394" y="1074.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="400" y="1090.481">Switch Team</text><polygon fill="#A80036" points="198,1124.6797,208,1128.6797,198,1132.6797,202,1128.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="24" x2="204" y1="1128.6797" y2="1128.6797"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="31" y="1123.6138">/team</text><polygon fill="#A80036" points="456,1168.9453,466,1172.9453,456,1176.9453,460,1172.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="220" x2="462" y1="1172.9453" y2="1172.9453"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="227" y="1152.7466">/auth/switchTeam</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="227" y="1167.8794">(authenticated call with JWT)</text><rect fill="#ADD8E6" filter="url(#fsoqwvb6wu5kg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="200" x="368" y="1185.9453"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="372" y="1202.0122">UserService.switchTeam()</text><polygon fill="#A80036" points="231,1231.2109,221,1235.2109,231,1239.2109,227,1235.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="225" x2="467" y1="1235.2109" y2="1235.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="237" y="1230.145">new JWT</text><polygon fill="#A80036" points="35,1260.3438,25,1264.3438,35,1268.3438,31,1264.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="29" x2="214" y1="1264.3438" y2="1264.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="41" y="1259.2778">Team Home of new team</text><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="900" x="0" y="1317.9102"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="1317.9102" y2="1317.9102"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="900" y1="1320.9102" y2="1320.9102"/><rect fill="#EEEEEE" filter="url(#fsoqwvb6wu5kg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="163" x="368.5" y="1307.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="374.5" y="1323.4106">Authenticated Calls</text><polygon fill="#A80036" points="456,1372.7422,466,1376.7422,456,1380.7422,460,1376.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="215" x2="462" y1="1376.7422" y2="1376.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="222" y="1356.5435">authenticated requests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="222" y="1371.6763">with JWT in header</text><polygon fill="#A80036" points="226,1401.875,216,1405.875,226,1409.875,222,1405.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="220" x2="467" y1="1405.875" y2="1405.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="232" y="1400.8091">HTTP 200 OK</text><!--MD5=[74f836532134f43014d1e2036b030e49]
@startuml
actor User
participant LiquidoApp
participant "Liquido Backend" as BE
participant AuthyAPI
participant AuthyApp

note over AuthyAPI: ""https://api.authy.com/protected/json""

== Register ==

User -> LiquidoApp: "/welcome"
activate LiquidoApp
LiquidoApp -> BE: ""POST /auth/register""\n""{email, profile.mobilephone}""
rnote over BE #lightblue: ""UserService.registerUser()""
BE -> AuthyAPI: ""POST /users/new""
AuthyAPI - -> BE: HTTP 200 OK
BE - -> LiquidoApp: HTTP 200 OK
LiquidoApp - -> User: registered successfully
deactivate LiquidoApp

== Login ==

User -> LiquidoApp: ""/login""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/requestToken""
rnote over BE #lightblue: ""UserService.sendSmsOrPushNotification()""
BE -> AuthyAPI: ""GET /sms/{AUTHY_ID}""
AuthyAPI -> AuthyApp: push notification
deactivate LiquidoApp

activate AuthyApp
note left of AuthyApp: AuthyApp pops up and\nshows a One Time Token (OTT) to user\n2FA: User switches back to LiquidoApp
AuthyApp -[#blue]->o User: User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.
deactivate AuthyApp

|||

User -> LiquidoApp: user manually enters OTT\nin LiquidoApp
activate LiquidoApp
LiquidoApp -> BE: ""/auth/loginWithToken""
rnote over BE #lightblue: ""UserService.verifyOneTimePassword()""
BE -> AuthyAPI: ""GET verify/{TOKEN}/{AUTHY_ID}""
AuthyAPI - -> BE: HTTP 200 OK
note over BE: If user is member of more than one team\nthen log him into his last used team.
BE - -> LiquidoApp: JsonWebToken (JWT)
LiquidoApp -> LiquidoApp: cache JWT in localStorage
LiquidoApp - -> User: login successful
deactivate LiquidoApp

|||
== Switch Team ==

User -> LiquidoApp: ""/team""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/switchTeam""\n(authenticated call with JWT)
rnote over BE #lightblue: ""UserService.switchTeam()""
' should I require authentication via authy here again?
BE - -> LiquidoApp: new JWT
LiquidoApp -> User: Team Home of new team
deactivate LiquidoApp

|||
== Authenticated Calls ==

LiquidoApp -> BE: authenticated requests\nwith JWT in header
BE - -> LiquidoApp: HTTP 200 OK
@enduml

@startuml
actor User
participant LiquidoApp
participant "Liquido Backend" as BE
participant AuthyAPI
participant AuthyApp

note over AuthyAPI: ""https://api.authy.com/protected/json""

== Register ==

User -> LiquidoApp: "/welcome"
activate LiquidoApp
LiquidoApp -> BE: ""POST /auth/register""\n""{email, profile.mobilephone}""
rnote over BE #lightblue: ""UserService.registerUser()""
BE -> AuthyAPI: ""POST /users/new""
AuthyAPI - -> BE: HTTP 200 OK
BE - -> LiquidoApp: HTTP 200 OK
LiquidoApp - -> User: registered successfully
deactivate LiquidoApp

== Login ==

User -> LiquidoApp: ""/login""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/requestToken""
rnote over BE #lightblue: ""UserService.sendSmsOrPushNotification()""
BE -> AuthyAPI: ""GET /sms/{AUTHY_ID}""
AuthyAPI -> AuthyApp: push notification
deactivate LiquidoApp

activate AuthyApp
note left of AuthyApp: AuthyApp pops up and\nshows a One Time Token (OTT) to user\n2FA: User switches back to LiquidoApp
AuthyApp -[#blue]->o User: User sees Authy one time token (OTT). 2FA: This is not a technical callback! This is human interaction.
deactivate AuthyApp

|||

User -> LiquidoApp: user manually enters OTT\nin LiquidoApp
activate LiquidoApp
LiquidoApp -> BE: ""/auth/loginWithToken""
rnote over BE #lightblue: ""UserService.verifyOneTimePassword()""
BE -> AuthyAPI: ""GET verify/{TOKEN}/{AUTHY_ID}""
AuthyAPI - -> BE: HTTP 200 OK
note over BE: If user is member of more than one team\nthen log him into his last used team.
BE - -> LiquidoApp: JsonWebToken (JWT)
LiquidoApp -> LiquidoApp: cache JWT in localStorage
LiquidoApp - -> User: login successful
deactivate LiquidoApp

|||
== Switch Team ==

User -> LiquidoApp: ""/team""
activate LiquidoApp
LiquidoApp -> BE: ""/auth/switchTeam""\n(authenticated call with JWT)
rnote over BE #lightblue: ""UserService.switchTeam()""
BE - -> LiquidoApp: new JWT
LiquidoApp -> User: Team Home of new team
deactivate LiquidoApp

|||
== Authenticated Calls ==

LiquidoApp -> BE: authenticated requests\nwith JWT in header
BE - -> LiquidoApp: HTTP 200 OK
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>